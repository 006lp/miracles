/*
 *  The main JavaScript file for Theme Miracles
 *  Author:  Eltrac
 *  License: MIT
 */
 
/**
 *  Use cookies
 */
//add cookie
function addCookie(name,value,expireHours){ 
    var cookieString=name+"="+escape(value);
    if(expireHours>0){ 
      var date=new Date(); 
	  date.setTime(date.getTime+expireHours*3600*1000); 
	  cookieString=cookieString+"; expire="+date.toGMTString(); 
    } 
    document.cookie=cookieString; 
}
//Delete cookie
function deleteCookie(name){ 
    var date=new Date(); 
    date.setTime(date.getTime()-10000); 
    document.cookie=name+"=v; expire="+date.toGMTString(); 
} 
//Get cookie
function getCookie(cname){ 
    var name = cname + "=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var ca = decodedCookie.split(';');
    for(var i = 0; i <ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
         }
         if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
         }
     }
    return "";
}

/**
 *  Dark theme
 */
//toggleDark
function Dark() {
	//Add classs to use dark theme
	$("body").toggleClass("body-dark");
	//Add cookie to record
	if($("body").hasClass("body-dark")) {
	    addCookie("darkTheme","on",0);
	}else{
		addCookie("darkTheme","off",0);
	}
}

/**
 *  Use filters
 */
//toggleGray
function Gray() {
	$("html").toggleClass("html-filter-gray");
	$("html").removeClass("html-filter-sepia");
    //add cookie to record
	if($("html").hasClass("html-filter-gray")) {
	    addCookie("grayFilter","on",0);
	}else{
		addCookie("grayFilter","off",0);
	}
}
//toggleSepia
function Sepia() {
	$("html").toggleClass("html-filter-sepia");
	$("html").removeClass("html-filter-gray");
	//add cookie to record
	if($("html").hasClass("html-filter-sepia")) {
	    addCookie("sepiaFilter","on",0);
	}else{
		addCookie("sepiaFilter","off",0);
	}
}

/**
 *  Explore and load themes/filter
 */
//explore and load dark theme
var whetherDark = getCookie("darkTheme");
var whetherGray = getCookie("grayFilter");
var whetherSepia = getCookie("sepiaFilter");
if(whetherDark == "on") {
	$("body").addClass("body-dark");
}
else if(whetherGray == "on") {
	$("html").addClass("html-filter-gray");
}
else if(whetherSepia == "on") {
	$("html").addClass("html-filter-sepia");
}

/**
 *  GoTop
 */
function GoTop() {
	$('body,html').animate({scrollTop:0},500);
	document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
}

/**
 *  Js Loader
 */
//LazyLoad
function LazyLoad() {
	jQuery(function() {
		jQuery("img").lazyload(
		  {threshold: 200,effect: "fadeIn"}
		);
	});
}
//Prism
function PrismLoad() {
    var pres = document.getElementsByTagName('pre');
    for (var i = 0; i < pres.length; i++){
		if (pres[i].getElementsByTagName('code').length > 0)pres[i].className  = 'line-numbers';
	}
}
function PrismReload() {
	if (typeof Prism !== 'undefined') {
      var pres = document.getElementsByTagName('pre');
      for (var i = 0; i < pres.length; i++){
        if (pres[i].getElementsByTagName('code').length > 0)
        pres[i].className  = 'line-numbers';
	  }
      Prism.highlightAll(true,null);
	}
}
//owo
function owoLoad() {
	var OwO_demo = new OwO({
		logo: 'OωO表情',
		container: document.getElementsByClassName('OwO')[0],
		target: document.getElementsByClassName('OwO-textarea')[0],
		api: owoJson,
		position: 'down',
		width: '300px',
		maxHeight: '250px'
	});
}
//Pangu.js
function panguLoad() {
	document.addEventListener('DOMContentLoaded', () => {
        pangu.autoSpacingPage();
    });
}

/**
 *  Prevent Scroll
 */
function bodyScroll(event){  
    event.preventDefault();  
} 
function banScroll() {
    $('html').css({'overflow':'hidden'});
}
function allowScroll() {
	$('html').css({'overflow':'auto'});
}

/**
 *  Open pannel
 */
//Search
function Search() {
	$(".search").toggleClass("ready");
	$(".search-close").toggleClass("ready");
	//Ban or allow scroll
	if($(".search").hasClass("ready")) {
		allowScroll();
	}else{
		banScroll();
	}
}
//mobileMenu
function toggleMobileMenu() {
	$(".mobile-menu").toggleClass("ready");
	$(".mobile-menu-close").toggleClass("ready");
	//Ban or allow scroll
	if($(".mobile-menu").hasClass("ready")) {
		allowScroll();
	}else{
		banScroll();
	}
}
//Login
function Login() {
	$(".login").toggleClass("ready");
	$(".login-close").toggleClass("ready");
	//Ban or allow scroll
	if($(".login").hasClass("ready")) {
		allowScroll();
	}else{
		banScroll();
	}
}

/**
 *  Front Options Pannel
 */
//FrontOptions
function toggleOptions() {
	$(".options").toggleClass("ready");
}
  //FontFamily
  function ChangeToSerif() {
	  $('body').addClass('body-serif');
	  $('.options-serif-button').addClass('options-button-active');
	  $('.options-sans-button').removeClass('options-button-active');
  }
  function ChangeToSansSerif() {
	  $('body').removeClass('body-serif');
	  $('.options-serif-button').removeClass('options-button-active');
	  $('.options-sans-button').addClass('options-button-active');
  }
  //SizeContent
  function SizeSmall() {
	  //add class for body
	  $('body').addClass('body-contentsize-small');
	  $('body').removeClass('body-contentsize-normal');
	  $('body').removeClass('body-contentsize-big');
	  $('body').removeClass('body-contentsize-large');
	  //active button
	  $('.options-sizesmall').addClass('options-button-active');
	  $('.options-sizenormal').removeClass('options-button-active');
	  $('.options-sizebig').removeClass('options-button-active');
	  $('.options-sizelarge').removeClass('options-button-active');
  }
  function SizeNormal() {
	  $('body').removeClass('body-contentsize-small');
	  $('body').addClass('body-contentsize-normal');
	  $('body').removeClass('body-contentsize-big');
	  $('body').removeClass('body-contentsize-large');
	  //active button
	  $('.options-sizesmall').removeClass('options-button-active');
	  $('.options-sizenormal').addClass('options-button-active');
	  $('.options-sizebig').removeClass('options-button-active');
	  $('.options-sizelarge').removeClass('options-button-active');
  }
  function SizeBig() {
	  $('body').removeClass('body-contentsize-small');
	  $('body').removeClass('body-contentsize-normal');
	  $('body').addClass('body-contentsize-big');
	  $('body').removeClass('body-contentsize-large');
	  //active button
	  $('.options-sizesmall').removeClass('options-button-active');
	  $('.options-sizenormal').removeClass('options-button-active');
	  $('.options-sizebig').addClass('options-button-active');
	  $('.options-sizelarge').removeClass('options-button-active');
  }
  function SizeLarge() {
	  $('body').removeClass('body-contentsize-small');
	  $('body').removeClass('body-contentsize-normal');
	  $('body').removeClass('body-contentsize-big');
	  $('body').addClass('body-contentsize-large');
	  //active button
	  $('.options-sizesmall').removeClass('options-button-active');
	  $('.options-sizenormal').removeClass('options-button-active');
	  $('.options-sizebig').removeClass('options-button-active');
	  $('.options-sizelarge').addClass('options-button-active');
  }

/**
 *  Drawer
 */
function toggleDrawer() {
	$("body").toggleClass("drawer-open");
	$(".mask").toggleClass("mask-open");
	//Ban or allow scroll
	if($("body").hasClass("drawer-open")) {
		banScroll();
	}else{
		allowScroll();
	}
}

/**
 *  Alert
 */
function alertSend(content,auto) {
	$(".alert-content").text(content);
	$(".alert").removeClass("ready");
	if (auto===true) {
		window.setTimeout(function(){$(".alert").addClass("ready");},3500);
	}
}
function alertClose() {
	$(".alert").addClass("ready");
}

/**
 *  Listen copy event
 */
$(document).ready(function() {  
    $("body").bind({  
        copy : function(){  
          alertSend("复制成功！若使用请注明原作者及原地址！",true);
        }
    });  
});   

/**
 *  Load Live2D
 */
var config = {
    model: {
        jsonPath: modelJson // 加载模型的json路径
    },
    display: {
        superSample: 1, // 超采样等级
        width: modelWidth, // canvas的宽度
        height: modelHeight, // canvas的高度
        position: 'left', // 显示位置：左或右
        hOffset: 12, // canvas水平偏移
        vOffset: 0, // canvas垂直偏移
    },
    mobile: {
        show: false, // 是否在移动设备上显示
        scale: 0.6, // 移动设备上的缩放
        motion: false, // 移动设备是否开启重力感应
    },
    react: {
        opacityDefault: 1, // 默认透明度
        opacityOnHover: 1 // 鼠标移上透明度
    }
}
L2Dwidget.init(config);

/**
 *  Load Pjax
 */
if(loadPjax = true) {
  $(document).pjax('a[href^="' + siteurl + '"]:not(a[target="_blank"], a[no-pjax], .comment-reply a, .cancel-comment-reply a)', {
    container: '#pjax-container',fragment: '#pjax-container',timeout: 8000
  }).on('pjax:send', function () {
	GoTop();
	beforePjax();
  }).on('pjax:complete', function () {
	$('form#login-form').addClass('need-refresh');
	NProgress.done();
	LazyLoad();
	PrismReload();
	afterPjax();
	panguLoad();
  });
}